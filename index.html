<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Tracktion Benchmarks</title>
</head>
<body>
  <h1>Tracktion Benchmarks</h1>
  <div id="charts"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  <script type="text/javascript" src="benchmarks.js"></script>
  <script>
    // var baseID = "app7ciI2i7URUtxUw";
    // var apiKey = "keyiTOaUByedY8vrY";

    // function httpGetAsync(theUrl, auth, callback)
    // {
    //     var xmlHttp = new XMLHttpRequest();
    //     xmlHttp.onreadystatechange = function() { 
    //         if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
    //             callback(xmlHttp.responseText);
    //     }

    //     xmlHttp.open("GET", theUrl, true); // true for asynchronous 

    //     if (auth)
    //       xmlHttp.setRequestHeader('Authorization', auth);

    //     xmlHttp.send(null);
    // }

    // httpGetAsync ("https://api.airtable.com/v0/app7ciI2i7URUtxUw/benchmarks?&view=Grid%20view",
    //               "Bearer keyiTOaUByedY8vrY",
    //              function (res) { console.log (res); parseRecords (JSON.parse (res)); });

    parseRecords (JSON.parse (benchmarks));

    function parseRecords (recordsObj)
    {
      charts.innerHTML = "";

      let records = recordsObj.records;
      var hashes = new Set();
      var hashAndFields = new Map();

      records.forEach (element =>
      {
        let hash = element.fields.Hash;
        hashes.add (hash);

        if (! Array.isArray (hashAndFields.get (hash)))
          hashAndFields.set (hash, []);

        hashAndFields.get (hash).push (element.fields);
      });

      hashAndFields.forEach (function (value, key, map)
      {
        var xValues = [];
        var yValues = [];
        var name = "", description = "", platform;

        value.forEach (field =>
        {
          xValues.push (field.Date);
          yValues.push (field.Ticks);
          name = field.Name;
          description = field.Description;
          platform = field.Platform;
        });

        addChart (key, name, platform + "/" + description,
                  xValues, yValues);
      });
    }

    function addChart (hash, title, subtitle, xValues, yValues)
    {
      var canvas = document.createElement ('canvas');
      canvas.id = hash;
      canvas.style="width:100%";
      charts.appendChild (canvas);

      var chart = new Chart (canvas.id, {
        type: "line",
        data: {
          labels: xValues,
          datasets: [{
            label: subtitle,
            data: yValues,
            lineTension: 0
          }]
        },
        options: {
          responsive: true,
          title: {
            display: true,
            text: [ title ]
          }
        }
      });
    }
  </script>
</body>
</html>
