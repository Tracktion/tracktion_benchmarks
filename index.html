<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Tracktion Benchmarks</title>
</head>
<body>
  <h1>Tracktion Benchmarks</h1>
  <div id="charts"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
  <script type="text/javascript" src="benchmarks.js"></script>
  <script>
    parseRecords (JSON.parse (benchmarks));

    function parseRecords (records)
    {
      charts.innerHTML = "";

      var hashes = new Set();
      var hashAndFields = new Map();

      records.forEach (element =>
      {
        let hash = element.benchmark_hash;
        hashes.add (hash);

        if (! Array.isArray (hashAndFields.get (hash)))
          hashAndFields.set (hash, []);

        hashAndFields.get (hash).push (element);
      });

      hashAndFields.forEach (function (value, key, map)
      {
        var xValues = [];
        var yValues = [];
        var name = "", description = "", platform;

        value.forEach (field =>
        {
          xValues.push (field.benchmark_time);
          yValues.push (field.benchmark_ticks);
          name = field.benchmark_name;
          description = field.benchmark_description;
          platform = field.benchmark_platform;
        });

        addChart (key, name, platform + "/" + description,
                  xValues, yValues);
      });
    }

    function addChart (hash, title, subtitle, xValues, yValues)
    {
      var canvas = document.createElement ('canvas');
      canvas.id = hash;
      canvas.style="width:100%";
      charts.appendChild (canvas);

      var chart = new Chart (canvas.id, {
        type: "line",
        data: {
          labels: xValues,
          datasets: [{
            label: subtitle,
            data: yValues,
            lineTension: 0
          }]
        },
        options: {
          responsive: true,
          title: {
            display: true,
            text: [ title ]
          }
        }
      });
    }
  </script>
</body>
</html>
